
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>Secure Authentication for Azure OpenAI Services: Beyond API Keys - Crafting Neurons - PlayBook</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#secure-authentication-for-azure-openai-services-beyond-api-keys" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Crafting Neurons - PlayBook" class="md-header__button md-logo" aria-label="Crafting Neurons - PlayBook" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Crafting Neurons - PlayBook
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Secure Authentication for Azure OpenAI Services: Beyond API Keys
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/MrDataPsycho/crafting-neurons-posts" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Crafting Neurons - PlayBook" class="md-nav__button md-logo" aria-label="Crafting Neurons - PlayBook" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Crafting Neurons - PlayBook
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/MrDataPsycho/crafting-neurons-posts" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Security
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Security
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../secure-authentication.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Secure Authentication
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../README.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    README
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#why-api-keys-are-not-meant-for-enterprise-production" class="md-nav__link">
    <span class="md-ellipsis">
      Why API Keys are not Meant for Enterprise Production
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Why API Keys are not Meant for Enterprise Production">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#potential-pitfalls" class="md-nav__link">
    <span class="md-ellipsis">
      Potential Pitfalls
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#real-cost-of-compromise" class="md-nav__link">
    <span class="md-ellipsis">
      Real Cost of Compromise
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#so-whats-the-alternative" class="md-nav__link">
    <span class="md-ellipsis">
      So What’s the Alternative?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#environment-variable-management-the-pydantic-advantage" class="md-nav__link">
    <span class="md-ellipsis">
      Environment Variable Management: The Pydantic Advantage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Environment Variable Management: The Pydantic Advantage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-settings-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      The Settings Architecture
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The Settings Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#base-settings-foundation-basepy" class="md-nav__link">
    <span class="md-ellipsis">
      Base Settings Foundation (base.py)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#production-ready-settings-corepy" class="md-nav__link">
    <span class="md-ellipsis">
      Production-Ready Settings (core.py)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-this-approach-rocks" class="md-nav__link">
    <span class="md-ellipsis">
      Why This Approach Rocks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-wrapper-client-azureopenaichatclient" class="md-nav__link">
    <span class="md-ellipsis">
      The Wrapper Client: AzureOpenAIChatClient
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The Wrapper Client: AzureOpenAIChatClient">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2-azure-ad-token-the-temporary-hero" class="md-nav__link">
    <span class="md-ellipsis">
      2. Azure AD Token: The Temporary Hero
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-certificate-based-authentication-the-production-champion" class="md-nav__link">
    <span class="md-ellipsis">
      3. Certificate-Based Authentication: The Production Champion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-default-azure-credential-the-intelligent-fallback" class="md-nav__link">
    <span class="md-ellipsis">
      4. Default Azure Credential: The Intelligent Fallback
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#environment-configuration-the-security-foundation" class="md-nav__link">
    <span class="md-ellipsis">
      Environment Configuration: The Security Foundation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Environment Configuration: The Security Foundation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#development-environment-setup" class="md-nav__link">
    <span class="md-ellipsis">
      Development Environment Setup
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="secure-authentication-for-azure-openai-services-beyond-api-keys">Secure Authentication for Azure OpenAI Services: Beyond API Keys</h1>
<p><em>Your API keys are like the master password to your digital kingdom – convenient for demos, catastrophic for production.</em></p>
<p>Picture this: It's 3 AM, and you're getting alerts about unexpected charges on your Azure OpenAI service. Someone has gotten hold of your API key and is running their cryptocurrency mining experiment using your GPT-4 credits. Sound far-fetched? It happens more often than you'd think.</p>
<p>In this deep dive, we'll explore why API keys should never see the light of production environments and how to implement bulletproof authentication for your Azure OpenAI.</p>
<h2 id="why-api-keys-are-not-meant-for-enterprise-production">Why API Keys are not Meant for Enterprise Production</h2>
<p>Before we dive into solutions, let's understand the magnitude of the problem. API keys are essentially long-lived passwords with unlimited power:</p>
<h3 id="potential-pitfalls">Potential Pitfalls</h3>
<ul>
<li><strong>No expiration date</strong>: That key you created 18 months ago? Still works perfectly</li>
<li><strong>Unlimited scope</strong>: One key, unlimited access to your entire Azure OpenAI resource</li>
<li><strong>Rotation nightmare</strong>: Changing keys means updating dozens of services simultaneously</li>
<li><strong>Storage sins</strong>: Keys end up in Git repos, Slack messages, and production logs</li>
<li><strong>Audit blindness</strong>: Who used the key? When? For what? Good luck figuring that out</li>
</ul>
<h3 id="real-cost-of-compromise">Real Cost of Compromise</h3>
<p>A leaked API key doesn't just mean unauthorized access – it means:
- <strong>Financial drain</strong>: Attackers using your expensive AI models for their projects
- <strong>Rate limit exhaustion</strong>: Your legitimate applications failing due to quota limits
- <strong>Data exposure</strong>: Potential access to your conversation history and sensitive prompts
- <strong>Compliance violations</strong>: Audit failures when you can't track usage patterns</p>
<h3 id="so-whats-the-alternative">So What’s the Alternative?</h3>
<p>The good news: Azure provides robust authentication mechanisms that are secure, manageable, and enterprise-ready. Here are few alternatives which we are going to explore in detail:</p>
<ol>
<li><strong>Azure AD Token Authentication</strong>: Short-lived tokens scoped to specific resources</li>
<li><strong>Certificate-Based Authentication</strong>: Strong, production-grade security using X.509 certificates, good for cross cloud scenarios</li>
<li><strong>Default Azure Credential</strong>: Intelligent, multi-source credential resolution for various environments, good for application deployed in Azure with RBAC (Role-Based Access Control)</li>
</ol>
<p>You can not get Azure AD Token directly rather you need to use custom or default token provider to get the token, which is short lived and can be scoped to specific resources. So no 1 is not really an alternative, but you will have to use method 2 or 3 to get the token. Apart from these you can also use Managed Identity, which is a special case of Default Azure Credential.</p>
<p>Full implementation of the solution can be found as packaged application library called <code>ailand</code> can be found in my github repo <a href="https://github.com/mrdatapsycho/ailand">here</a>.</p>
<p>But Before we jump into the solution forst lets discuss another important aspect of secure authentication, which is environment variable management.</p>
<h2 id="environment-variable-management-the-pydantic-advantage">Environment Variable Management: The Pydantic Advantage</h2>
<p>One of the biggest challenges in secure authentication is managing configuration without hardcoding sensitive values. So far I have a good experience with Pydantic settings management. </p>
<h3 id="the-settings-architecture">The Settings Architecture</h3>
<p>Our settings system for <code>ailand</code> follows a clean hierarchy:</p>
<pre><code>utils/settings/
├── base.py     # Abstract base settings with common functionality
└── core.py     # Concrete implementations for different auth scenarios
</code></pre>
<h4 id="base-settings-foundation-basepy">Base Settings Foundation (<code>base.py</code>)</h4>
<pre><code class="language-python">from pathlib import Path
from pydantic_settings import BaseSettings, SettingsConfigDict
from loguru import logger


DEFAULT_ENV_PATH = Path(&quot;.envs&quot;)
DEFAULT_ENV_FILE_CANDIDATES = [
    DEFAULT_ENV_PATH.joinpath(&quot;local.env&quot;),
    DEFAULT_ENV_PATH.joinpath(&quot;dev.env&quot;),
]


def find_env_file_if_exists() -&gt; Path | None:
        &quot;&quot;&quot;
        Check for the existence of environment files in the default locations.
        Returns the first found env file path or None if none exist.
        &quot;&quot;&quot;
        ... # Check the Implementation in GitHub repository
        return None


class ABCBaseSettings(BaseSettings):
    model_config = SettingsConfigDict(
        env_file=find_env_file_if_exists(),
        env_file_encoding=&quot;utf-8&quot;,
        extra=&quot;ignore&quot;,
        case_sensitive=False,
    )

    @classmethod
    def from_env_file(cls, env_path: str | Path) -&gt; &quot;ABCBaseSettings&quot;:
        &quot;&quot;&quot;
        Load settings from a specific environment file.
        Raises FileNotFoundError if the file does not exist.
        Args:
            env_path: Path to the .env file to load settings from.
        &quot;&quot;&quot;
        env_path = Path(env_path)
        if not env_path.exists():
            raise FileNotFoundError(f&quot;Env file {env_path} does not exist.&quot;)

        class CustomSettings(cls):  # dynamically override model_config
            model_config = SettingsConfigDict(
                env_file=env_path,
                env_file_encoding=&quot;utf-8&quot;,
                extra=&quot;ignore&quot;,
                case_sensitive=False,
            )

        return CustomSettings()
</code></pre>
<p>Using this base class, we can create specialized settings for different authentication methods but also we will be able to initialize settings from different environment files (<code>from_env_file</code>) or system environment variables which is fantastic for local development and prototyping in environment like Jupyter notebooks.</p>
<h4 id="production-ready-settings-corepy">Production-Ready Settings (<code>core.py</code>)</h4>
<pre><code class="language-python"># core.py

class AOAISettings(ABCBaseSettings):
    # Basic connection settings
    OPENAI_API_BASE: str
    OPENAI_API_BASE_SN: str  # Switzerland region endpoint


class AOAICerteSettings(AOAISettings):
    # Certificate-based authentication
    TENANT_ID: str
    CLIENT_ID: str
    RESOURCE: str
    PUBLIC_CERT_KEY: str
    PRIVATE_CERT_KEY: str

    @property
    def certificate_string(self) -&gt; bytes:
        &quot;&quot;&quot;Combine certificates for Azure authentication&quot;&quot;&quot;
        return self.PRIVATE_CERT_KEY.encode() + b&quot;\n&quot; + self.PUBLIC_CERT_KEY.encode()

# ... More settings classes like AOAIKeySettings for API key based auth
</code></pre>
<p>Now we have a separate settings class for certificate based authentication, we can also create another class for API key based authentication if needed.</p>
<h3 id="why-this-approach-rocks">Why This Approach Rocks</h3>
<ol>
<li><strong>Type Safety</strong>: Pydantic validates your configuration at startup</li>
<li><strong>Environment Flexibility</strong>: Seamlessly switch between <code>.env</code> files and environment variables</li>
<li><strong>Post-Processing</strong>: Automatic URL normalization and certificate handling</li>
<li><strong>Fallback Strategy</strong>: Graceful degradation from local to dev to production settings</li>
</ol>
<h2 id="the-wrapper-client-azureopenaichatclient">The Wrapper Client: <code>AzureOpenAIChatClient</code></h2>
<p>Lets discuss the client implementation for Azure OpenAI service, which is implemented in <code>src/ailand/core/clients/openai/chat.py</code>. This client encapsulates all the authentication logic and provides a simple interface for making chat completions, tool calling, and structured output parsing.</p>
<pre><code class="language-python">aoai_endpoint_settings = AOAIEndpointSettings()
aoai_key_settings = AOAIKeySettings()

# ⚠️ Development and testing ONLY
client = AzureOpenAIChatClient(
    model=ChatModelSelection.GPT4_1_MINI,
    api_version=APIVersion.DEFAULT,
    endpoint=aoai_endpoint_settings.OPENAI_API_BASE_DEFAULT,
    api_key=aoai_key_settings.OPENAI_API_BASE_DEFAULT
)
</code></pre>
<p><strong>When to use</strong>: Development, testing, quick prototypes<br />
<strong>When to avoid</strong>: Production, any environment where security matters</p>
<h3 id="2-azure-ad-token-the-temporary-hero">2. Azure AD Token: The Temporary Hero</h3>
<pre><code class="language-python"># 🕐 Short-lived token (typically 1 hour)
from azure.identity import DefaultAzureCredential

credential = DefaultAzureCredential()
token = credential.get_token(&quot;https://cognitiveservices.azure.com/.default&quot;)

client = AzureOpenAIChatClient(
    model=ChatModelSelection.GPT4_1_MINI,
    api_version=APIVersion.DEFAULT,
    endpoint=aoai_endpoint_settings.OPENAI_API_BASE_DEFAULT,
    azure_ad_token=token.token
)
</code></pre>
<p><strong>Advantages</strong>: 
- Automatic expiration (limited blast radius)
- Integrates with Azure AD policies
- Can be scoped to specific resources</p>
<p><strong>Use case</strong>: Service-to-service communication where you manage token lifecycle</p>
<p><strong>Complexity</strong>:
- Requires token management (refreshing tokens)</p>
<h3 id="3-certificate-based-authentication-the-production-champion">3. Certificate-Based Authentication: The Production Champion</h3>
<p>This is where our architecture really shines. The certificate-based approach leverages our settings system for maximum security:</p>
<pre><code class="language-python"># 🔐 Production-grade security
settings = AOAICerteSettings()

client = AzureOpenAIChatClient(
    ... # Other parameters
    aoai_settings=settings  # Client automatically uses certificate auth
)
</code></pre>
<p>Behind the scenes, our client (<code>src/ailand/utils/core/clients/openai/chat.py</code>) uses the sophisticated authentication resolver:</p>
<pre><code class="language-python">def _resolve_authentication(self, api_key, azure_ad_token, aoai_settings):
    # Certificate authentication (highest priority for settings-based auth)
    if aoai_settings:
        try:
            return {&quot;azure_ad_token_provider&quot;: get_cert_token_provider(aoai_settings)}
        except Exception as e:
            logger.warning(f&quot;Certificate auth failed: {e}&quot;)

    # Fallback to DefaultAzureCredential
    try:
        token_provider = get_bearer_token_provider(
            DefaultAzureCredential(), 
            DEFAULT_COGNITIVE_SERVICE_ENDPOINT
        )
        return {&quot;azure_ad_token_provider&quot;: token_provider}
    except Exception as e:
        raise ValueError(f&quot;No valid authentication method available: {e}&quot;)
</code></pre>
<h3 id="4-default-azure-credential-the-intelligent-fallback">4. Default Azure Credential: The Intelligent Fallback</h3>
<pre><code class="language-python">client = AzureOpenAIChatClient(
    model=...,
    api_version=...,
    endpoint=...,
    # No explicit auth - DefaultAzureCredential takes over
)
</code></pre>
<p>This method intelligently tries multiple authentication sources:
1. Environment variables (for containerized applications)
2. Managed Identity (when running in Azure)
3. Visual Studio Code credentials (for developers)
4. Azure CLI credentials (for local development)</p>
<h2 id="environment-configuration-the-security-foundation">Environment Configuration: The Security Foundation</h2>
<h3 id="development-environment-setup">Development Environment Setup</h3>
<p>Create <code>.envs/local.env</code> for local development:</p>
<pre><code class="language-bash"># Basic connection
OPENAI_API_BASE_DEFAULT=https://your-resource.openai.azure.com
OPENAI_API_BASE_ALT=https://your-alt-resource.openai.azure.com

# Certificate-based auth (development certificates)
TENANT_ID=... # Your Azure AD tenant ID
CLIENT_ID=... # Your Azure AD app client ID
RESOURCE=https://cognitiveservices.azure.com/.default

# Certificates (properly escaped)
PUBLIC_CERT_KEY=... # Read if from a PEM file or environment variable
PRIVATE_CERT_KEY=... # Read if from a PEM file or environment variable

# Logging control
LOG_LEVEL=DEBUG
</code></pre>
<p>So when app is deployed in Azure or AWS the App will expect that the environment variables are set in the environment itself from a devops pipeline, which is a best practice. When running the app locally it will look for <code>.envs/local.env</code> or <code>.envs/dev.env</code> file. You can check the full implementation of the wrapper client in my github repo <a href="https://github.com/your-repo">here</a>.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>